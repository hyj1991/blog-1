<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>ZXCCHEN.blog</title>
    <script src="/node_modules/jquery/dist/jquery.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>
    <link type="text/css" rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
    <link type="text/css" rel="stylesheet" href="/resources/css/main.css">
</head>

<body>
    <div class="container">
        <div id='back'>Top</div>
        <div class="col-lg-2 col-xs-3" id='sidebar'></div>
        <div class="col-lg-8 col-xs-9" id='content'>
            <h1 data-type=0 data-time="2017-05-02 14:12:46">贪吃蛇</h1>
            <div id="snake_box"></div>
            <div id="snake_btn">
                <button id="start">开始</button>
                <button id="stop">暂停</button>
                <button id="clear">清除</button>
            </div>
            <script>
                var box = document.getElementById('snake_box');
                var btn = document.getElementById('snake_btn');
                var map = []; //地图
                var rows = 20; //行数
                var cols = 20; //列数
                var sbody = [];
                var snake;
                var food;
                var timer;
                var direction = 'right';

                function draw() {
                    var tmp = '';
                    for (var i = 0; i < rows; i++) {
                        for (var j = 0; j < cols; j++) {
                            tmp += '<div></div>';
                            map.push({
                                x: i + 1,
                                y: j + 1
                            })
                        }
                    }
                    box.innerHTML = tmp;
                }
                draw();

                function init() {
                    for (var i = 0; i < box.children.length; i++) {
                        box.children[i].className = '';
                    }
                    sbody = [];
                    snake = Number.parseInt(Math.random() * 400);
                    sbody.push({
                        x: map[snake].x,
                        y: map[snake].y
                    });
                    food = newFoodPos();
                    box.children[snake].className = 'snake';
                    box.children[food].className = 'food';
                    document.onkeydown = keyDown;
                    timer = null;
                }

                function check(direction) {
                    var head = sbody[0];
                    switch (direction) {
                        case 'left':
                            if (head.y <= 1) {
                                return false;
                            }
                            break;
                        case 'right':
                            if (head.y >= 20) {
                                return false;
                            }
                            break;
                        case 'up':
                            if (head.x <= 1) {
                                return false;
                            }
                            break;
                        case 'down':
                            if (head.x >= 20) {
                                return false;
                            }
                            break;
                    }
                    return true;
                }

                function getPos(posObj) {
                    return (posObj.x - 1) * cols + (posObj.y - 1);
                }

                function keyDown(e) {
                    var e = e || window.event;
                    switch (e.keyCode) {
                        case 37: //左
                            if (direction != 'left' && direction != 'right') {
                                direction = 'left';
                            }
                            break;
                        case 38: //上
                            if (direction != 'up' && direction != 'down') {
                                direction = 'up';
                            }
                            break;
                        case 39: //右
                            if (direction != 'right' && direction != 'left') {
                                direction = 'right';
                            }
                            break;
                        case 40: //下
                            if (direction != 'up' && direction != 'down') {
                                direction = 'down';
                            }
                            break;
                    }
                }

                function newFoodPos() {
                    while (true) {
                        var ok = true;
                        var pos = Number.parseInt(Math.random() * 400);
                        for (var i = 0; i < sbody.length; i++) {
                            var snakePos = getPos(sbody[i]);
                            if (snakePos == pos) {
                                ok = false;
                                break;
                            }
                        }
                        if (ok) {
                            return pos;
                        }
                    }
                }


                function clock() {
                    if (check(direction)) {
                        var head = sbody[0];
                        var newHead = {};
                        if (direction == 'right') {
                            newHead.x = head.x;
                            newHead.y = head.y + 1;
                        } else if (direction == 'left') {
                            newHead.x = head.x;
                            newHead.y = head.y - 1;
                        } else if (direction == 'up') {
                            newHead.x = head.x - 1;
                            newHead.y = head.y;
                        } else if (direction == 'down') {
                            newHead.x = head.x + 1;
                            newHead.y = head.y;
                        }
                        sbody.unshift(newHead);
                        var tail = sbody[sbody.length - 1];
                        var headPos = getPos(newHead);
                        var tailPos = getPos(tail);
                        if (headPos == food) {
                            box.children[headPos].className = 'snake';
                            food = newFoodPos();
                            box.children[food].className = 'food';
                        } else {
                            box.children[headPos].className = 'snake';
                            box.children[tailPos].className = '';
                            sbody.pop();
                        }
                        timer = setTimeout(clock, 300);
                    } else {
                        var head = sbody[0];
                        var headPos = getPos(head);
                        box.children[headPos].className = 'red';
                        clearTimeout(timer);
                    }
                }

                btn.addEventListener('click', function (e) {
                    if (e.target.nodeName == 'BUTTON') {
                        if (e.target.getAttribute('id') == 'start') {
                            init();
                            setTimeout(clock, 300);
                        }
                        if (e.target.getAttribute('id') == 'stop') {
                            clearTimeout(timer);
                        }
                        if (e.target.getAttribute('id') == 'clear') {
                            init();
                            clearTimeout(timer);
                        }
                    }
                })
            </script>
            <div id='btn'><span id='page_up'>上一章</span><span id='page_down'>下一章</span></div>
        </div>
    </div>
    <div class="container" id="box_foot"></div>
</body>

</html>